[
  {
    "path": "posts/2021-02-05-upping-your-pipe-game/",
    "title": "%$%: upping your pipe game",
    "description": "I love the `magrittr`/`dplyr` pipe: `%>%`. But it's meant to work with `tidyverse` functions, and it doesn't always work well with base R functions that take a single data frame column as input. Here, I use data about my friends' pets to explain how a different `magrittr` pipe, `%$%`, solves that problem.",
    "author": [
      {
        "name": "Kaija Gahm",
        "url": {}
      }
    ],
    "date": "2021-02-05",
    "categories": [],
    "contents": "\n\n\n\nThis post has been slightly modified from its original form on woodpeckR.\nProblem\nWhat do I do when %>% doesn’t work?\nContext\nI love the %>% pipe. Originally from magrittr, it’s now characteristic of most tidyverse code. Using %>% has revolutionized how I write code in R. But sometimes the basic pipe falls short.\ntable() is one of my favorite functions for exploring data in R: it creates a frequency table of values in a vector. I use table() to do sanity checks on my data, make sure that all factor levels are present, and generally get a sense of how my observations are distributed.\nA while back, though, I noticed that table() didn’t play nice with the %>% pipe.\nI’ve collected some data on my friends’ pets. Here it is (using pseudonyms, in case anyone has a secret pet they don’t want the world to know about…).\n\n\n\nFigure 1: This is one of the cats in the data frame below. She would like to hold your hand.\n\n\n\n\n\n# Load magrittr\nlibrary(magrittr)\nlibrary(dplyr)\n\n# Create data\npets <- data.frame(\n  friend = c(\"Mark\", \"Mark\", \"Kyle\", \"Kyle\", \"Miranda\", \"Kayla\", \n             \"Kayla\", \"Kayla\", \"Adriana\", \"Adriana\", \"Alex\", \"Randy\", \"Nancy\"), \n  pet = c(\"cat\", \"cat\", \"cat\", \"cat\", \"cat\", \"dog\", \"cat\", \"lizard\", \n          \"cat\", \"cat\", \"dog\", \"dog\", \"woodpecker\"), \n  main_pet_color = c(\"brown\", \"brown\", \"multi\", \"multi\", \"brown\", \n                     \"brown\", \"brown\", \"orange\", \"black\", \"white\", \n                     \"multi\", \"white\", \"multi\")) \n\n# Look at the data\npets\n\n\n    friend        pet main_pet_color\n1     Mark        cat          brown\n2     Mark        cat          brown\n3     Kyle        cat          multi\n4     Kyle        cat          multi\n5  Miranda        cat          brown\n6    Kayla        dog          brown\n7    Kayla        cat          brown\n8    Kayla     lizard         orange\n9  Adriana        cat          black\n10 Adriana        cat          white\n11    Alex        dog          multi\n12   Randy        dog          white\n13   Nancy woodpecker          multi\n\nUnsurprisingly, it looks like there are a lot of cats and dogs! There are also a lot of brown pets and a lot of multicolored ones. Let’s say I want to see a frequency table of the pet colors. I know that I can do this with table(), like so:\n\n\n# Make a frequency table of pet colors\ntable(pets$main_pet_color)\n\n\n\n black  brown  multi orange  white \n     1      5      4      1      2 \n\nBut if I want to use tidy syntax, I might try to do it this way instead:\n\n\npets %>%\n  table(main_pet_color)\n\n\nError in table(., main_pet_color): object 'main_pet_color' not found\n\nWhat’s up with this? The syntax should work. pet is definitely a valid variable name in the data frame pets, and if I had used a different function, like arrange(), I would have had no problems:\n\n\n# Arrange the data frame by pet color\npets %>% arrange(main_pet_color) # works fine!\n\n\n    friend        pet main_pet_color\n1  Adriana        cat          black\n2     Mark        cat          brown\n3     Mark        cat          brown\n4  Miranda        cat          brown\n5    Kayla        dog          brown\n6    Kayla        cat          brown\n7     Kyle        cat          multi\n8     Kyle        cat          multi\n9     Alex        dog          multi\n10   Nancy woodpecker          multi\n11   Kayla     lizard         orange\n12 Adriana        cat          white\n13   Randy        dog          white\n\nSo why doesn’t this work with table()?? This problem has driven me crazy on several occasions. I always ended up reverting back to the table(pets$main_pet_color) syntax, but I was not happy about it.\nTurns out, there’s a simple fix.\nSolution\nIntroducing… a new pipe! %$% is called the “exposition pipe,” according to the magrittr package documentation, and it’s basically the tidy version of the with() function, which I wrote about previously.\nIf we simply swap out %>% for %$% in our failed code above, it works!\n\n\n# Make a frequency table of pet colors\npets %$% table(main_pet_color)\n\n\nmain_pet_color\n black  brown  multi orange  white \n     1      5      4      1      2 \n\nImportant note: Make sure you have magrittr loaded if you want to use this pipe. dplyr includes the basic %>%, but not the other magrittr pipes.\nWhy it works\nThe traditional pipe, %>%, works by passing a data frame or tibble into the next function. But that only works if the function you’re piping to is set up to take a data frame/tibble as an argument!\nFunctions in the tidyverse, like arrange(), are set up to take this kind of argument, so that piping works seamlessly. But many base R functions take vectors as inputs instead.\nThat’s the case with table(). When we write table(pets$main_pet_color), the argument pets$main_pet_color is a vector:\n\n\n# This returns a vector\npets$main_pet_color\n\n\n [1] \"brown\"  \"brown\"  \"multi\"  \"multi\"  \"brown\"  \"brown\"  \"brown\" \n [8] \"orange\" \"black\"  \"white\"  \"multi\"  \"white\"  \"multi\" \n\nWhen we try to pass pets into table() with the pipe, table() expects a vector but gets a data frame instead, and it throws an error.\nThe %$% pipe “exposes” the column names of the data frame to the function you’re piping to, allowing that function to make sense of the data frame that is passed to it.\nOutcome\nThe exposition pipe is great for integrating non-tidyverse functions into a tidy workflow. The outcome for me is that I can finally make frequency tables to my heart’s content, without “code switching” back from tidy to base R syntax. Of course, the downside is that you do have to install magrittr, which is sometimes an extra dependency that I don’t want to deal with. But it’s nice to have the option!\n\n\n\nFigure 2: Congrats, you made it to the end! Here are some more cats for you.\n\n\n\nResources\nmagrittr has a couple other pipes, too: %T% and %<>%. The package also has some nice aliases for basic arithmetic functions that allow them to be incorporated into a chain of pipes. To read more about these magrittr options, scroll to the bottom of the magrittr vignette.\nNote: The image at the top of this post was modified from the magrittr documentation.\n\n\n\n",
    "preview": "posts/2021-02-05-upping-your-pipe-game/magrittr.jpg",
    "last_modified": "2021-02-08T20:16:50-05:00",
    "input_file": "upping-your-pipe-game.utf8.md"
  }
]
